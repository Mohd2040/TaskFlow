name: Security Vulnerability Scan

on:
  # ðŸŽ¯ Trigger on push to specific branches
  push:
    branches: 
      - main
      - develop
      - devops3
      # Add your branches here
  # ðŸŽ® Manual trigger with custom DAST URL
  workflow_dispatch:
    inputs:
      dast_url:
        description: 'Target URL for DAST scan (leave empty to skip DAST)'
        required: false
        type: string
        default: ''

# ðŸ”’ Permissions needed
permissions:
  contents: read
  security-events: write
  actions: read

jobs:
  call-security-scan:
    name: Run Security Scan
    uses: Mohd2040/security-qa-assistant/.github/workflows/reusable-security.yml@devops3
    with:
      project_type: 'node'
      run_trivy_sca: true
      run_npm_audit: true
      run_codeql: true
      

      defectdojo_enabled: ${{ github.event_name == 'push' || github.event_name == 'workflow_dispatch' }}
      #defectdojo_auto_create: true
      defectdojo_auto_create: ${{ github.event_name == 'push' || github.event_name == 'workflow_dispatch' }}


      #dast_url: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.dast_url || 'https://security-qa-assistant.onrender.com/' }}
    secrets: inherit