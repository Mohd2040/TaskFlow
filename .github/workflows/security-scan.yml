# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”’ Security Scan Workflow - Ready to Use Template
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 
# ğŸ“‹ Quick Setup Instructions:
# 1. Copy this file to: .github/workflows/security-scan.yml
# 2. Update the 'uses' path to point to your reusable workflow repo
# 3. Configure secrets in repository settings (if using DefectDojo)
# 4. Push to your branch - that's it! âœ…
#
# ğŸ” Required Secrets (only if using DefectDojo):
#   - DEFECTDOJO_URL: Your DefectDojo server URL
#   - DEFECTDOJO_TOKEN: Your DefectDojo API token
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: Security Vulnerability Scan

on:
  # ğŸ¯ Trigger on push to specific branches
  push:
    branches: 
      - main
      - develop
      - devops3
      # Add your branches here
  
  # ğŸ”€ Trigger on pull requests
  pull_request:
    branches: 
      - main
      - develop
      - devops3
  
  # â° Schedule: Run every Monday at 2 AM UTC (optional)
  # schedule:
  #   - cron: '0 2 * * 1'
  
  # ğŸ® Manual trigger with custom DAST URL
  workflow_dispatch:
    inputs:
      dast_url:
        description: 'Target URL for DAST scan (leave empty to skip DAST)'
        required: false
        type: string
        default: ''

# ğŸ”’ Permissions needed
permissions:
  contents: read
  security-events: write
  actions: read

jobs:
  security-scan:
    name: Run Security Scans
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸ”§ IMPORTANT: Update this path to your reusable workflow!
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Examples:
    #   - Same repo: ./.github/workflows/reusable-security.yml
    #   - Different repo: org/repo/.github/workflows/reusable-security.yml@main
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    uses: Mohd2040/security-qa-assistant/.github/workflows/reusable-security.yml@devops3
    
    with:
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ—ï¸ PROJECT CONFIGURATION
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      project_type: 'node'  # Options: node, python, java, go, dotnet
      
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ” SCA (Software Composition Analysis) SCANS
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      run_npm_audit: true              # npm security audit
      run_trivy_sca: true              # Trivy dependency scan
      run_dependency_check: true        # OWASP Dependency-Check
      
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ” SAST (Static Application Security Testing) SCANS
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      run_Semgrep_sca: true            # Semgrep SAST scan
      run_codeql: true                 # GitHub CodeQL analysis
      codeql_languages: 'javascript-typescript'  # Options: javascript-typescript, python, java, go, cpp, csharp
      codeql_queries: 'security-extended'        # Options: security-extended, security-and-quality
      
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸŒ DAST (Dynamic Application Security Testing) SCAN
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Set your application URL here OR leave empty to skip DAST
      dast_url: ${{ github.event.inputs.dast_url || '' }}
      # Example: dast_url: 'https://your-app.example.com'
      
      # DAST Authentication (if needed)
      dast_auth_enabled: false
      # dast_login_url: 'https://your-app.example.com/login'
      # dast_username_field: 'username'
      # dast_password_field: 'password'
      # dast_success_indicator: '/dashboard'
      
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ“Š DEFECTDOJO INTEGRATION
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Enable DefectDojo: auto-uploads results after scans
    #  defectdojo_enabled: ${{ github.event_name == 'push' || github.event_name == 'workflow_dispatch' }}
      
      # ğŸ¤– Smart Auto-Management: 
      # - Creates Product if not exists (using repo name)
      # - Creates Engagement if not exists (using branch name)
      # - Updates existing tests with new findings
      # - No manual setup needed! âœ¨
    #  defectdojo_auto_create: true
      
      # Product Type in DefectDojo (will be created if not exists)
    #  defectdojo_product_type: 'Web Application'
      # Other options: 'Mobile App', 'API', 'Infrastructure', etc.
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ğŸ” SECRETS (Configure in: Settings > Secrets > Actions)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    secrets: inherit
    # OR specify explicitly:
    # secrets:
    #   DEFECTDOJO_URL: ${{ secrets.DEFECTDOJO_URL }}
    #   DEFECTDOJO_TOKEN: ${{ secrets.DEFECTDOJO_TOKEN }}
    #   dast_username: ${{ secrets.DAST_USERNAME }}  # If using DAST auth
    #   dast_password: ${{ secrets.DAST_PASSWORD }}  # If using DAST auth

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“š ADDITIONAL NOTES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ¯ What this workflow does:
#   âœ… Scans dependencies for known vulnerabilities (SCA)
#   âœ… Analyzes code for security issues (SAST)
#   âœ… Tests running application for vulnerabilities (DAST - optional)
#   âœ… Auto-uploads results to DefectDojo (if enabled)
#   âœ… Generates comprehensive security reports
#   âœ… Blocks merges if critical vulnerabilities found
#
# ğŸ¤– DefectDojo Smart Features:
#   âœ… Auto-creates Product (named after your repo)
#   âœ… Auto-creates Engagement (named after your branch)
#   âœ… Auto-creates Tests on first scan
#   âœ… Auto-updates Tests on subsequent scans
#   âœ… Deduplicates findings automatically
#   âœ… Zero manual configuration needed!
#
# ğŸ“Š Results Location:
#   â€¢ GitHub Actions Summary: Check workflow run page
#   â€¢ Artifacts: Download from workflow run
#   â€¢ DefectDojo: Organized by Product > Engagement > Tests
#
# ğŸ”§ Customization Tips:
#   â€¢ Disable scans you don't need (set to false)
#   â€¢ Add more branches to trigger on
#   â€¢ Adjust schedule for regular scans
#   â€¢ Configure DAST for your application
#
# ğŸ†˜ Troubleshooting:
#   â€¢ If DefectDojo upload fails: Check URL and token
#   â€¢ If scans fail: Check runner has required tools
#   â€¢ If too many findings: Start with critical/high only
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•