name: Security Vulnerability Scan

on:
  # ðŸŽ¯ Trigger on push to specific branches
  push:
    branches: 
      - main
      # Add your branches here
  # ðŸŽ® Manual trigger with custom DAST URL
  workflow_dispatch:
    inputs:
      runner_labels:
        required: false
        type: string
        #default: '["self-hosted", "ubuntudevops"]'
        default: '["ubuntu-latest"]'    
      dast_url:
        description: 'Target URL for DAST scan (leave empty to skip DAST)'
        required: false
        type: string
        default: ''

# ðŸ”’ Permissions needed
permissions:
  contents: read
  security-events: write
  actions: read

jobs:
  call-security-scan:
    name: Run Security Scan
    uses: Mohd2040/security-qa-assistant/.github/workflows/reusable-security.yml@devops3
    with:
      runner_labels: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.runner_labels || '["ubuntu-latest"]' }}
      project_type: 'auto'
      run_trivy_sca: false
      run_npm_audit: false
      run_codeql: true
    #  defectdojo_enabled: ${{ github.event_name == 'push' || github.event_name == 'workflow_dispatch' }}
    #  defectdojo_auto_create: ${{ github.event_name == 'push' || github.event_name == 'workflow_dispatch' }}
      dast_url: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.dast_url || '' }}
    secrets: inherit